{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- CSS Stylesheet -->
    <link rel="stylesheet" href="{% static 'css/todo.css' %}">
</head>
<body>

<div class="container">

    <!-- ===================== TOAST MESSAGES ===================== -->
    <!--
        Floating toast messages appear at the top-right corner.
        Each message disappears automatically after 2 seconds.
    -->
    <div id="toast-container">
        {% if messages %}
            {% for message in messages %}
                <div class="toast {{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- ===================== ADD NEW TASK FORM ===================== -->
    <section class="form-section">

        <!-- THEME TOGGLE -->
        <!--
            Toggle between dark mode and light mode.
        -->
        <div class="theme-toggle">
            <span class="icon">üåô</span>
            <label class="switch">
                <input type="checkbox" id="themeSwitch">
                <span class="slider"></span>
            </label>
            <span class="icon">‚òÄÔ∏è</span>
        </div>

        <!-- Form Heading -->
        <h2 class="head-title">Add New Task</h2>
        <p class="sub-title">Organize your work and stay productive</p>

        <!-- Form -->
        <form method="post" action="/todo/" enctype="multipart/form-data" id="todoForm">
            {% csrf_token %}
            <!-- Hidden input to store todo ID for updates -->
            <input type="hidden" name="todo_id" id="todo_id">

            <div class="form-grid">
                <!-- Task Title Input -->
            <input type="text" name="title" id="titleInput"
            placeholder="Search or enter task title..."
            autocomplete="off"
            value="{{ query|default:'' }}"
            required>

                <!-- Duration Input -->
<!--                 <input type="number" name="duration_days" id="durationInput"
                    min="1" placeholder="Days need to complete" required> -->
                <input type="datetime-local" name="end_time" id="endTimeInput" required>

                <!-- File Upload -->
                <label class="file-upload">
                    üìé Upload
                    <input type="file" name="image">
                </label>

                <!-- Submit Button -->
                <button type="submit" class="btn add-btn" id="submitBtn">
                    ‚ûï Add
                </button>

                <!-- Clear Button -->
                <button type="button" class="btn clear-btn" id="clearBtn">
                    ‚úñ Clear
                </button>
            </div>
        </form>
    </section>

    <!-- ===================== TODO LIST ===================== -->
<div class="todo-list-container">
    {% for todo in all_todo %}
    <div class="show-part {% if todo.done %}completed{% endif %}">
        
        <!-- LEFT SECTION: Checkbox + Title + Image -->
        <div class="left">
            <div class="todo-item">
                
                <!-- Checkbox + Title -->
                <div class="todo-item-left">
                    <!-- Checkbox -->
                    <label class="todo-item">
                        <input type="checkbox" {% if todo.done %}checked disabled{% endif %}>
                        <span class="checkmark"></span>
                    </label>
                    
                    <!-- Task Title -->
                    <div class="todo-item">
                        <span class="title"
                            data-id="{{ todo.id }}"
                            data-title="{{ todo.title }}"
                            data-endtime="{{ todo.end_time|date:'Y-m-d\\TH:i' }}">
                            {{ todo.title }}
                        </span>
                    </div>
                </div>

                <!-- Optional Task Image -->
                <div class="todo-item-right">
                    {% if todo.image %}
                    <span class="todo-image">
                        <img src="{{ todo.image.url }}">
                    </span>
                    {% endif %}
                </div>

            </div>
        </div>

        <!-- RIGHT SECTION: Deadline + Controls -->
        <div class="right">
            <div class="right-time">
                {% if not todo.done %}
                <!-- Countdown Timer -->
                <div class="deadline" data-endtime="{{ todo.end_time|date:'Y-m-d H:i:s' }}">
                    <div class="deadline-format"><h4 class="days">0</h4><span>days</span></div>
                    <div class="deadline-format"><h4 class="hours">0</h4><span>hrs</span></div>
                    <div class="deadline-format"><h4 class="minutes">0</h4><span>min</span></div>
                    <div class="deadline-format"><h4 class="seconds">0</h4><span>sec</span></div>
                </div>
                {% else %}
                    <!-- Completed Text -->
                    <span class="done-text">Completed</span>
                {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="right-control">
                <div class="right-control-done">
                    <a href="/done/{{ todo.id }}" class="btn-outline green">Done</a>
                </div>
                <div class="right-control-delete">
                    <a href="/delete/{{ todo.id }}" class="btn-outline red">Delete</a>
                </div>
            </div>
        </div>

    </div>
    {% empty %}
    <p>No tasks found.</p>

    {% endfor %}
</div>


<!-- PAGINATION -->
<div class="pagination">
  {% if all_todo.has_previous %}
    <a href="?page={{ all_todo.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="prev">&laquo; Prev</a>
  {% else %}
    <span class="prev disabled">&laquo; Prev</span>
  {% endif %}

  {% for num in all_todo.paginator.page_range %}
    {% if num == all_todo.number %}
      <span class="page active">{{ num }}</span>
    {% else %}
      <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}" class="page">{{ num }}</a>
    {% endif %}
  {% endfor %}

  {% if all_todo.has_next %}
    <a href="?page={{ all_todo.next_page_number }}{% if query %}&q={{ query }}{% endif %}" class="next">Next &raquo;</a>
  {% else %}
    <span class="next disabled">Next &raquo;</span>
  {% endif %}
</div>
    <!-- ===================== TODO LIST ===================== -->

</div>

<!-- ===================== JS SCRIPT ===================== -->
<!-- Handles countdown timers, update form, clear form, toast messages, theme toggle -->
<script src="{% static 'js/todo.js' %}"></script>

</body>
</html>
